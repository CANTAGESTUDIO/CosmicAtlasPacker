# MVP Specification

> **Stage**: MVP
> **Last Modified**: 2025-12-22
> **Status**: Draft

---

## Summary

POC에서 검증된 핵심 기능을 기반으로 편의 기능을 추가하여 실제 사용 가능한 에디터를 완성합니다.
투명도 기반 자동 슬라이싱, 피봇 설정, 프로젝트 저장/로드, ID 검증 기능을 구현합니다.

---

## 1. Goals

| 목표 | 설명 |
|------|------|
| 자동 슬라이싱 | 투명도 기반 Flood Fill 알고리즘으로 스프라이트 자동 감지 |
| 피봇 시스템 | 9개 프리셋 + 커스텀 피봇 좌표 지원 |
| 프로젝트 관리 | .atlas 프로젝트 파일 저장/로드 |
| ID 검증 | 스프라이트 ID 중복 실시간 검증 |
| UI 개선 | 속성 패널, 스프라이트 목록 패널 완성 |

---

## 2. Scope

### 2.1 포함 범위 (In Scope)

| 기능 | 상세 |
|------|------|
| 투명도 기반 자동 슬라이싱 | Connected Components (Flood Fill) 알고리즘 |
| 알파 임계값 설정 | 0~255 범위 설정 가능 |
| 최소 스프라이트 크기 | 너무 작은 영역 필터링 |
| 피봇 프리셋 (9개) | TopLeft, TopCenter, TopRight, CenterLeft, Center, CenterRight, BottomLeft, BottomCenter, BottomRight |
| 커스텀 피봇 | 0.0~1.0 normalized 좌표 입력 |
| 시각적 피봇 핸들 | 캔버스에서 드래그로 피봇 조절 |
| 프로젝트 저장 | .atlas 확장자 JSON 파일 |
| 프로젝트 로드 | 저장된 프로젝트 복원 |
| ID 편집 UI | 텍스트 필드로 스프라이트 ID 수정 |
| ID 중복 검증 | 실시간 중복 감지 및 경고 |
| 스프라이트 목록 패널 | 썸네일 리스트, 다중 선택 |
| 속성 패널 | 선택된 스프라이트 정보 표시/편집 |

### 2.2 제외 범위 (Out of Scope)

- 애니메이션 시퀀스 편집기
- 9-Slice Border 설정
- Undo/Redo
- 다중 소스 이미지
- 키보드 단축키
- 드래그&드롭 파일 로드

---

## 3. Technical Specifications

### 3.1 추가 의존성

```yaml
dependencies:
  # 기존 POC 의존성 +
  freezed_annotation: ^2.4.1
  json_annotation: ^4.8.1
  path_provider: ^2.1.2

dev_dependencies:
  build_runner: ^2.4.8
  freezed: ^2.4.6
  json_serializable: ^6.7.1
```

### 3.2 자동 슬라이싱 알고리즘 (Flood Fill)

```
1. 이미지에서 알파 채널 추출 → 2D 배열
2. 알파 > 임계값인 픽셀을 1, 아니면 0으로 변환
3. 방문하지 않은 1인 픽셀 발견 시:
   - Flood Fill로 연결된 모든 픽셀 탐색
   - 바운딩 박스 계산
   - 최소 크기 이상이면 스프라이트로 등록
4. 모든 픽셀 순회 완료까지 반복
```

### 3.3 피봇 좌표 시스템

| 프리셋 | X | Y |
|--------|---|---|
| TopLeft | 0.0 | 0.0 |
| TopCenter | 0.5 | 0.0 |
| TopRight | 1.0 | 0.0 |
| CenterLeft | 0.0 | 0.5 |
| Center | 0.5 | 0.5 |
| CenterRight | 1.0 | 0.5 |
| BottomLeft | 0.0 | 1.0 |
| BottomCenter | 0.5 | 1.0 |
| BottomRight | 1.0 | 1.0 |

### 3.4 프로젝트 파일 형식 (.atlas)

```json
{
  "version": "1.0.0",
  "projectName": "my_sprites",
  "settings": {
    "maxWidth": 2048,
    "maxHeight": 2048,
    "padding": 2,
    "extrude": 1,
    "trimTransparent": true,
    "powerOfTwo": true
  },
  "sourceFiles": [
    {
      "path": "/path/to/spritesheet.png",
      "relativePath": "spritesheet.png"
    }
  ],
  "sprites": [
    {
      "id": "enemy_idle",
      "sourceFile": "spritesheet.png",
      "sourceRect": { "x": 0, "y": 0, "w": 64, "h": 64 },
      "pivot": { "x": 0.5, "y": 1.0, "preset": "bottomCenter" }
    }
  ],
  "meta": {
    "createdAt": "2025-12-22T10:00:00Z",
    "modifiedAt": "2025-12-22T15:30:00Z"
  }
}
```

---

## 4. Modules

### 4.1 Models 모듈 (추가/수정)

| 파일 | 역할 |
|------|------|
| `lib/models/pivot_point.dart` | 피봇 포인트 모델 (freezed) |
| `lib/models/enums/pivot_preset.dart` | 피봇 프리셋 열거형 |
| `lib/models/atlas_project.dart` | 프로젝트 모델 확장 (저장/로드 지원) |

### 4.2 Services 모듈 (추가)

| 파일 | 역할 |
|------|------|
| `lib/services/image_slicer_service.dart` | autoSlice() 메서드 추가 |
| `lib/services/project_service.dart` | 프로젝트 저장/로드 |
| `lib/services/validation_service.dart` | ID 중복 검증 |

### 4.3 Providers 모듈 (추가)

| 파일 | 역할 |
|------|------|
| `lib/providers/selection_provider.dart` | 선택된 스프라이트 관리 |
| `lib/providers/tool_provider.dart` | 현재 툴 상태 |

### 4.4 Widgets 모듈 (추가)

| 파일 | 역할 |
|------|------|
| `lib/widgets/panels/sprite_list_panel.dart` | 스프라이트 목록 패널 |
| `lib/widgets/panels/properties_panel.dart` | 속성 편집 패널 |
| `lib/widgets/common/pivot_preset_selector.dart` | 3x3 피봇 선택 위젯 |
| `lib/widgets/common/sprite_thumbnail.dart` | 스프라이트 썸네일 |
| `lib/widgets/canvas/pivot_handle.dart` | 피봇 드래그 핸들 |
| `lib/widgets/dialogs/grid_slice_dialog.dart` | 그리드 슬라이싱 설정 다이얼로그 |

---

## 5. Deliverables

| 산출물 | 설명 |
|--------|------|
| 자동 슬라이싱 | Flood Fill 기반 자동 스프라이트 감지 |
| 피봇 시스템 | 9개 프리셋 + 커스텀 피봇 UI |
| 프로젝트 파일 | .atlas 저장/로드 기능 |
| ID 관리 | 편집 UI + 중복 검증 |
| 완성된 4패널 레이아웃 | Source, Atlas Preview, Properties, Sprite List |

---

## 6. Risks & Mitigations

| 리스크 | 영향 | 완화 방안 |
|--------|------|----------|
| Flood Fill 성능 (대형 이미지) | 중간 | 비동기 처리, 진행률 표시 |
| 프로젝트 파일 호환성 | 중간 | 버전 필드 도입, 마이그레이션 로직 |
| 피봇 드래그 정밀도 | 낮음 | 스냅 기능, 숫자 입력 병행 |

---

## 7. Notes

- MVP 완료 시 개인 프로젝트에서 실제 사용 가능한 수준이어야 함
- 피봇 시스템은 BatchRenderer의 가변 크기 확장과 연계 필요
- 프로젝트 파일은 소스 이미지 상대 경로 저장으로 이식성 확보
- ID 검증은 내보내기 전 필수 검증 단계로 포함

---

*Generated by Claude Code - 2025-12-22*
