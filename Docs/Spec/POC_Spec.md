# POC Specification

> **Stage**: POC
> **Last Modified**: 2025-12-22
> **Status**: Draft

---

## Summary

Flutter Desktop 기반 텍스처 패킹 에디터의 핵심 기술 검증 단계입니다.
이미지 로드, 슬라이싱, 빈 패킹 알고리즘, PNG+JSON 내보내기의 기술적 실현 가능성을 확인합니다.

---

## 1. Goals

| 목표 | 설명 |
|------|------|
| 이미지 로드 검증 | Flutter Desktop에서 대용량 PNG 이미지 로드 및 표시 |
| 슬라이싱 알고리즘 검증 | 수동 사각형 선택 및 그리드 슬라이싱 동작 확인 |
| 빈 패킹 알고리즘 검증 | MaxRects BSSF 알고리즘 구현 및 패킹 결과 확인 |
| 내보내기 검증 | PNG 아틀라스 + JSON 메타데이터 출력 동작 확인 |
| BatchRenderer 호환성 검증 | 출력된 JSON이 기존 BatchRenderer와 호환되는지 확인 |

---

## 2. Scope

### 2.1 포함 범위 (In Scope)

| 기능 | 상세 |
|------|------|
| 이미지 로드 | file_picker를 통한 PNG 파일 로드 |
| 소스 캔버스 | 로드된 이미지 표시 (줌/팬 기본 지원) |
| 수동 슬라이싱 | 마우스 드래그로 사각형 영역 선택 |
| 그리드 슬라이싱 | Cell Size / Cell Count 기반 자동 분할 |
| 스프라이트 ID | 기본 ID 자동 부여 (sprite_0, sprite_1, ...) |
| 빈 패킹 | MaxRects Best Short Side Fit 알고리즘 |
| 아틀라스 프리뷰 | 패킹 결과 실시간 미리보기 |
| PNG 내보내기 | 패킹된 아틀라스 이미지 저장 |
| JSON 내보내기 | PRD 섹션 7.1 형식의 메타데이터 출력 |

### 2.2 제외 범위 (Out of Scope)

- 투명도 기반 자동 슬라이싱
- 피봇/앵커 설정
- 애니메이션 시퀀스
- 9-Slice Border
- 프로젝트 저장/로드
- Undo/Redo
- 다중 소스 이미지

---

## 3. Technical Specifications

### 3.1 프로젝트 설정

| 항목 | 값 |
|------|-----|
| Flutter SDK | 3.24+ |
| Dart SDK | 3.5+ |
| 타겟 플랫폼 | macOS (우선), Windows, Linux |
| 상태관리 | Riverpod |

### 3.2 핵심 의존성

```yaml
dependencies:
  flutter_riverpod: ^2.5.1
  file_picker: ^6.1.1
  image: ^4.1.3
  path: ^1.8.3
```

### 3.3 빈 패킹 알고리즘 (MaxRects BSSF)

```
1. 스프라이트를 면적 기준 내림차순 정렬
2. 초기 빈 사각형 = 전체 아틀라스 영역
3. 각 스프라이트에 대해:
   - Best Short Side Fit 휴리스틱으로 최적 위치 탐색
   - 스프라이트 배치
   - Guillotine Split으로 빈 영역 분할
4. 모든 스프라이트 배치 완료 시 성공
```

---

## 4. Modules

### 4.1 Core 모듈

| 파일 | 역할 |
|------|------|
| `lib/core/utils/image_utils.dart` | 이미지 로드/처리 유틸리티 |
| `lib/core/utils/file_utils.dart` | 파일 I/O 유틸리티 |

### 4.2 Models 모듈

| 파일 | 역할 |
|------|------|
| `lib/models/sprite_data.dart` | 스프라이트 정보 모델 |
| `lib/models/atlas_project.dart` | 프로젝트 데이터 모델 |

### 4.3 Services 모듈

| 파일 | 역할 |
|------|------|
| `lib/services/image_slicer_service.dart` | 그리드 슬라이싱 로직 |
| `lib/services/bin_packer_service.dart` | MaxRects 빈 패킹 알고리즘 |
| `lib/services/export_service.dart` | PNG + JSON 내보내기 |

### 4.4 Providers 모듈

| 파일 | 역할 |
|------|------|
| `lib/providers/project_provider.dart` | 프로젝트 상태 관리 |
| `lib/providers/editor_state_provider.dart` | 에디터 UI 상태 |

### 4.5 Widgets 모듈

| 파일 | 역할 |
|------|------|
| `lib/widgets/panels/source_panel.dart` | 소스 이미지 패널 |
| `lib/widgets/panels/atlas_preview_panel.dart` | 아틀라스 프리뷰 패널 |
| `lib/widgets/canvas/source_canvas.dart` | 소스 이미지 캔버스 |
| `lib/screens/editor_screen.dart` | 메인 에디터 화면 |

---

## 5. Deliverables

| 산출물 | 설명 |
|--------|------|
| Flutter Desktop 프로젝트 | 기본 프로젝트 구조 및 의존성 설정 |
| 이미지 로드 기능 | PNG 파일 로드 및 표시 |
| 슬라이싱 기능 | 수동 + 그리드 슬라이싱 |
| 빈 패킹 기능 | MaxRects BSSF 구현 |
| 내보내기 기능 | PNG 아틀라스 + JSON 메타데이터 |
| 호환성 테스트 결과 | BatchRenderer 연동 테스트 |

---

## 6. Risks & Mitigations

| 리스크 | 영향 | 완화 방안 |
|--------|------|----------|
| 대용량 이미지 메모리 이슈 | 높음 | 이미지 청크 로딩, 메모리 모니터링 |
| 빈 패킹 실패 (공간 부족) | 중간 | 아틀라스 크기 자동 확장, 에러 메시지 |
| 플랫폼별 파일 경로 차이 | 낮음 | path 패키지 사용, 플랫폼 테스트 |

---

## 7. Notes

- POC 단계에서는 UI 완성도보다 기술 검증에 집중
- 모든 알고리즘은 PRD 섹션 5에 정의된 명세 준수
- JSON 출력 형식은 PRD 섹션 7.1 스키마와 100% 일치해야 함
- BatchRenderer 호환성이 가장 중요한 검증 항목

---

*Generated by Claude Code - 2025-12-22*
